<!DOCTYPE html>
<html lang="es">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>TortillApuestas | La app de apuestas entre amigos</title>
   <script src="https://cdn.tailwindcss.com"></script>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   <style>
	   .tortilla-bg {
		   background-color: #fef3c7;
	   }
	   .tortilla-card {
		   background-color: #fef3c7;
		   border: 2px solid #f59e0b;
		   border-radius: 0.5rem;
	   }
	   .tortilla-button {
		   background-color: #f59e0b;
		   color: white;
		   transition: all 0.3s;
	   }
	   .tortilla-button:hover {
		   background-color: #d97706;
		   transform: scale(1.05);
	   }
	   .floating-tortilla {
		   animation: float 3s ease-in-out infinite;
	   }
	   @keyframes float {
		   0% { transform: translateY(0px); }
		   50% { transform: translateY(-10px); }
		   100% { transform: translateY(0px); }
	   }
   </style>
</head>
<body class="tortilla-bg min-h-screen">
   <div class="container mx-auto px-4 py-8 max-w-4xl">
	   <!-- Header -->
	   <header class="flex flex-col items-center mb-8">
		   <div class="floating-tortilla mb-4">
			   <img id="header-image" src="https://via.placeholder.com/113x113/f59e0b/ffffff?text=ü•ö" alt="Ilustraci√≥n de una tortilla de patata espa√±ola jugosa con cebolla, vista desde arriba con estilo cartoon" class="rounded-full border-4 border-amber-500" style="width: 30mm; height: 30mm; object-fit: cover;">
		   </div>
		   <h1 class="text-4xl font-bold text-amber-800 mb-2">TortillApuestas</h1>
		   <p class="text-lg text-amber-700">¬°Donde las apuestas se pagan con tortilla!</p>
	   </header>
 
	   <!-- Main Content -->
	   <main>
		   <!-- Tabs Navigation -->
		   <div class="flex border-b border-amber-300 mb-6">
			   <button id="tab-activas" class="px-4 py-2 font-medium text-amber-800 border-b-2 border-amber-500 active-tab">Apuestas Activas</button>
			   <button id="tab-nueva" class="px-4 py-2 font-medium text-amber-600">Nueva Apuesta</button>
			   <button id="tab-historial" class="px-4 py-2 font-medium text-amber-600">Historial</button>
		   </div>
 
		   <!-- Apuestas Activas Tab -->
		   <div id="contenido-activas" class="tab-content">
			   <div class="flex justify-between items-center mb-4">
				   <h2 class="text-2xl font-semibold text-amber-800">Apuestas en juego</h2>
				   <span id="contador-apuestas" class="bg-amber-500 text-white px-3 py-1 rounded-full text-sm">0</span>
			   </div>
			   
			   <div id="lista-apuestas" class="grid gap-4 md:grid-cols-2">
				   <!-- Aqu√≠ se cargar√°n las apuestas din√°micamente -->
			   </div>
		   </div>
 
		   <!-- Nueva Apuesta Tab -->
		   <div id="contenido-nueva" class="tab-content hidden">
			   <h2 class="text-2xl font-semibold text-amber-800 mb-4">Crear nueva apuesta</h2>
			   <form id="form-nueva-apuesta" class="space-y-4">
				   <div>
					   <label for="titulo" class="block text-sm font-medium text-amber-700">T√≠tulo de la apuesta</label>
					   <input type="text" id="titulo" class="mt-1 block w-full rounded-md border-amber-300 shadow-sm focus:border-amber-500 focus:ring-amber-500" placeholder="Ej: ¬øQui√©n ganar√° la liga?" required>
				   </div>
				   
				   <div>
					   <label for="descripcion" class="block text-sm font-medium text-amber-700">Descripci√≥n</label>
					   <textarea id="descripcion" rows="2" class="mt-1 block w-full rounded-md border-amber-300 shadow-sm focus:border-amber-500 focus:ring-amber-500" placeholder="Detalles de la apuesta"></textarea>
				   </div>
				   
				   <div>
					   <label class="block text-sm font-medium text-amber-700">Participantes</label>
					   <div class="mt-1 space-y-2">
						   <div class="flex items-center">
							   <input type="checkbox" id="participante1" value="Jorge" class="h-4 w-4 rounded border-amber-300 text-amber-600 focus:ring-amber-500">
							   <label for="participante1" class="ml-2 block text-sm text-amber-700">Jorge</label>
						   </div>
						   <div class="flex items-center">
							   <input type="checkbox" id="participante2" value="Mar√≠a" class="h-4 w-4 rounded border-amber-300 text-amber-600 focus:ring-amber-500">
							   <label for="participante2" class="ml-2 block text-sm text-amber-700">Mar√≠a</label>
						   </div>
						   <div class="flex items-center">
							   <input type="checkbox" id="participante3" value="Carlos" class="h-4 w-4 rounded border-amber-300 text-amber-600 focus:ring-amber-500">
							   <label for="participante3" class="ml-2 block text-sm text-amber-700">Carlos</label>
						   </div>
						   <div class="flex items-center">
							   <input type="checkbox" id="participante4" value="Luc√≠a" class="h-4 w-4 rounded border-amber-300 text-amber-600 focus:ring-amber-500">
							   <label for="participante4" class="ml-2 block text-sm text-amber-700">Luc√≠a</label>
						   </div>
					   </div>
				   </div>
				   
				   <div class="pt-4">
					   <button type="submit" class="w-full tortilla-button px-4 py-2 rounded-md font-medium flex items-center justify-center">
						   <i class="fas fa-plus-circle mr-2"></i> Crear Apuesta
					   </button>
				   </div>
			   </form>
		   </div>
 
		   <!-- Historial Tab -->
		   <div id="contenido-historial" class="tab-content hidden">
			   <h2 class="text-2xl font-semibold text-amber-800 mb-4">Historial de apuestas</h2>
			   
			   <div id="lista-historial" class="grid gap-4 md:grid-cols-2 mb-6">
				   <!-- Aqu√≠ se cargar√° el historial en formato tarjeta -->
			   </div>
			   
			   <div class="p-4 tortilla-card mt-4">
				   <h3 class="text-lg font-medium text-amber-800 mb-2">Estad√≠sticas</h3>
				   <div class="grid grid-cols-3 gap-4 text-center">
					   <div>
						   <p class="text-sm text-amber-600">Total apuestas</p>
						   <p id="total-apuestas" class="text-2xl font-bold text-amber-800">0</p>
					   </div>
					   <div>
						   <p class="text-sm text-amber-600">Tortillas pagadas</p>
						   <p id="tortillas-pagadas" class="text-2xl font-bold text-amber-800">0</p>
					   </div>
					   <div>
						   <p class="text-sm text-amber-600">Rey de la tortilla</p>
						   <p id="rey-tortilla" class="text-2xl font-bold text-amber-800">-</p>
					   </div>
				   </div>
			   </div>
		   </div>
	   </main>
   </div>
 
   <script>
       // Funciones para localStorage
       function cargarDatos() {
           const apuestasGuardadas = localStorage.getItem('tortillaBET_apuestas');
           const historialGuardado = localStorage.getItem('tortillaBET_historial');
           
           if (apuestasGuardadas) {
               apuestas = JSON.parse(apuestasGuardadas);
           } else {
               // Datos de ejemplo solo si no hay datos guardados
               apuestas = [
                   {
                       id: 1,
                       titulo: "¬øLlover√° el fin de semana?",
                       descripcion: "Apostamos a que no llover√° durante el finde en Madrid",
                       participantes: ["Jorge", "Mar√≠a", "Carlos"],
                       fecha: "2023-06-15",
                       estado: "activa",
                       ganador: null,
                       resultado: ""
                   },
                   {
                       id: 2,
                       titulo: "Apuesta del Mundial",
                       descripcion: "Argentina ganar√° el pr√≥ximo mundial",
                       participantes: ["Carlos", "Luc√≠a"],
                       fecha: "2023-06-10",
                       estado: "activa",
                       ganador: null
                   }
               ];
           }
           
           if (historialGuardado) {
               historial = JSON.parse(historialGuardado);
           } else {
               // Datos de ejemplo solo si no hay datos guardados
               historial = [
                   {
                       id: 3,
                       titulo: "Qui√©n llega tarde",
                       descripcion: "Jorge llegar√° m√°s de 15 minutos tarde a la cena",
                       participantes: ["Jorge", "Mar√≠a", "Carlos", "Luc√≠a"],
                       fecha: "2023-06-01",
                       estado: "finalizada",
                       ganador: "Mar√≠a",
                       tortillas: 1
                   }
               ];
           }
       }

       function guardarDatos() {
           localStorage.setItem('tortillaBET_apuestas', JSON.stringify(apuestas));
           localStorage.setItem('tortillaBET_historial', JSON.stringify(historial));
       }

       // Variables globales
       let apuestas = [];
       let historial = [];
 
	   // DOM Elements
	   const tabActivas = document.getElementById('tab-activas');
	   const tabNueva = document.getElementById('tab-nueva');
	   const tabHistorial = document.getElementById('tab-historial');
	   const contenidoActivas = document.getElementById('contenido-activas');
	   const contenidoNueva = document.getElementById('contenido-nueva');
	   const contenidoHistorial = document.getElementById('contenido-historial');
	   const listaApuestas = document.getElementById('lista-apuestas');
	   const historialBody = document.getElementById('historial-body');
	   const formNuevaApuesta = document.getElementById('form-nueva-apuesta');
	   const contadorApuestas = document.getElementById('contador-apuestas');
	   const totalApuestas = document.getElementById('total-apuestas');
	   const tortillasPagadas = document.getElementById('tortillas-pagadas');
	   const reyTortilla = document.getElementById('rey-tortilla');
 
	   // Tab switching
	   tabActivas.addEventListener('click', () => {
		   contenidoActivas.classList.remove('hidden');
		   contenidoNueva.classList.add('hidden');
		   contenidoHistorial.classList.add('hidden');
		   document.getElementById('header-image').src = "https://via.placeholder.com/113x113/f59e0b/ffffff?text=ü•ö";
		   updateActiveTab(tabActivas, tabNueva, tabHistorial);
		   renderApuestasActivas();
	   });
 
	   tabNueva.addEventListener('click', () => {
		   contenidoActivas.classList.add('hidden');
		   contenidoNueva.classList.remove('hidden');
		   contenidoHistorial.classList.add('hidden');
		   updateActiveTab(tabNueva, tabActivas, tabHistorial);
	   });
 
	   tabHistorial.addEventListener('click', () => {
		   contenidoActivas.classList.add('hidden');
		   contenidoNueva.classList.add('hidden');
		   contenidoHistorial.classList.remove('hidden');
		   updateActiveTab(tabHistorial, tabActivas, tabNueva);
		   document.getElementById('header-image').src = "https://via.placeholder.com/113x113/d97706/ffffff?text=üìä";
		   renderHistorial();
		   updateEstadisticas();
	   });
 
	   function updateActiveTab(activeTab, ...otherTabs) {
		   activeTab.classList.remove('text-amber-600');
		   activeTab.classList.add('text-amber-800', 'border-amber-500');
		   otherTabs.forEach(tab => {
			   tab.classList.remove('text-amber-800', 'border-amber-500');
			   tab.classList.add('text-amber-600');
		   });
	   }
 
	   // Render apuestas activas
	   function renderApuestasActivas() {
		   listaApuestas.innerHTML = '';
		   const apuestasActivas = apuestas.filter(a => a.estado === 'activa' || a.estado === 'finalizada');
		   contadorApuestas.textContent = apuestasActivas.length;
		   
		   if (apuestasActivas.length === 0) {
			   listaApuestas.innerHTML = `
				   <div class="col-span-2 p-4 text-center tortilla-card">
					   <p class="text-amber-700">No hay apuestas activas. ¬°Crea una nueva!</p>
				   </div>
			   `;
			   return;
		   }
 
		   apuestasActivas.forEach(apuesta => {
			   const participantesHtml = apuesta.participantes.map(p => 
				   `<span class="inline-block bg-amber-100 rounded-full px-3 py-1 text-sm font-semibold text-amber-700 mr-2 mb-2">${p}</span>`
			   ).join('');
 
			   const card = document.createElement('div');
			   card.className = 'p-4 tortilla-card';
			   card.innerHTML = `
				   <div class="flex justify-between items-start">
					   <h3 class="text-lg font-bold text-amber-800">${apuesta.titulo}</h3>
					   <button class="text-white bg-amber-600 hover:bg-amber-700 px-3 py-1 rounded-md text-sm finalizar-btn" data-id="${apuesta.id}" title="Marcar ganador" ${apuesta.estado === 'finalizada' ? 'disabled' : ''}>
						   ${apuesta.estado === 'finalizada' ? '<i class="fas fa-check mr-1"></i>Finalizada' : '<i class="fas fa-trophy mr-1"></i>Finalizar'}
					   </button>
				   </div>
				   <p class="text-amber-700 mt-1">${apuesta.descripcion}</p>
				   <div class="mt-3">
					   ${participantesHtml}
				   </div>
				   <p class="text-sm text-amber-600 mt-2"><i class="far fa-calendar-alt mr-1"></i> ${apuesta.fecha}</p>
				   <div class="mt-3 border-t border-amber-200 pt-2">
					   <p class="text-xs font-semibold text-amber-600 uppercase">Estado</p>
					   ${apuesta.estado === 'finalizada' ? 
						   `<p class="text-sm text-amber-700">üèÜ Finalizada - <button onclick="marcarPagada(${apuesta.id})" class="text-amber-600 hover:text-amber-800 underline">Marcar como pagada</button></p>` :
						   `<p class="text-sm text-amber-700">‚è≥ Sin resultados</p>`}
				   </div>
			   `;
			   listaApuestas.appendChild(card);
		   });
 
		   // Add event listeners to finalizar buttons
		   document.querySelectorAll('.finalizar-btn').forEach(btn => {
			   btn.addEventListener('click', (e) => {
				   const id = parseInt(e.currentTarget.getAttribute('data-id'));
				   finalizarApuesta(id);
			   });
		   });
	   }
 
	   // Render historial
	   function renderHistorial() {
		   const listaHistorial = document.getElementById('lista-historial');
		   listaHistorial.innerHTML = '';
		   
		   if (historial.length === 0) {
			   listaHistorial.innerHTML = `
				   <div class="col-span-2 p-4 text-center tortilla-card">
					   <p class="text-amber-700">No hay apuestas en el historial</p>
				   </div>
			   `;
			   return;
		   }
 
		   historial.forEach(apuesta => {
			   const participantesHtml = apuesta.participantes.map(p => 
				   `<span class="inline-block bg-amber-100 rounded-full px-3 py-1 text-sm font-semibold text-amber-700 mr-2 mb-2">${p}</span>`
			   ).join('');
 
			   const card = document.createElement('div');
			   card.className = 'p-4 tortilla-card';
			   card.innerHTML = `
				   <div class="flex justify-between items-start">
					   <h3 class="text-lg font-bold text-amber-800">${apuesta.titulo}</h3>
				   </div>
				   <p class="text-amber-700 mt-1">${apuesta.descripcion}</p>
				   <div class="mt-3">
					   ${participantesHtml}
				   </div>
				   <p class="text-sm text-amber-600 mt-2"><i class="far fa-calendar-alt mr-1"></i> ${apuesta.fecha}</p>
				   <div class="mt-3 border-t border-amber-200 pt-2">
					   <p class="text-xs font-semibold text-amber-600 uppercase">Resultado</p>
					   <p class="text-sm font-medium text-green-600">üèÜ Ganador: ${apuesta.ganador}</p>
					   <p class="text-sm font-medium text-amber-700">ü•ö Tortillas: ${apuesta.tortillas}</p>
					   ${apuesta.resultado ? `<p class="text-sm font-medium text-gray-700">üìù Resultado: ${apuesta.resultado}</p>` : ''}
				   </div>
			   `;
			   listaHistorial.appendChild(card);
		   });
	   }
 
	   // Update estad√≠sticas
	   function updateEstadisticas() {
		   totalApuestas.textContent = historial.length;
		   
		   const totalTortillas = historial.reduce((total, apuesta) => total + (apuesta.tortillas || 0), 0);
		   tortillasPagadas.textContent = totalTortillas;
		   
		   // Calcular rey de la tortilla
		   const ganadores = {};
		   historial.forEach(apuesta => {
			   if (apuesta.ganador) {
				   ganadores[apuesta.ganador] = (ganadores[apuesta.ganador] || 0) + 1;
			   }
		   });
		   
		   let maxGanadas = 0;
		   let rey = '-';
		   for (const [nombre, count] of Object.entries(ganadores)) {
			   if (count > maxGanadas) {
				   maxGanadas = count;
				   rey = nombre;
			   }
		   }
		   
		   reyTortilla.textContent = rey !== '-' ? `${rey} (${maxGanadas})` : rey;
	   }
 
	   // Form handler - nueva apuesta
	   formNuevaApuesta.addEventListener('submit', function(e) {
		   e.preventDefault();
		   
		   const titulo = document.getElementById('titulo').value;
		   const descripcion = document.getElementById('descripcion').value;
		   
		   const participantes = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
			   .map(el => el.value);
		   
		   if (participantes.length < 2) {
			   alert('¬°Necesitas al menos 2 participantes para una apuesta!');
			   return;
		   }
		   
		   const nuevaApuesta = {
			   id: apuestas.length + 1,
			   titulo,
			   descripcion,
			   participantes,
			   fecha: new Date().toISOString().split('T')[0],
			   estado: 'activa',
			   ganador: null,
			   resultado: ""
		   };
		   
           apuestas.push(nuevaApuesta);
           guardarDatos(); // Guardar en localStorage
           
           // Reset form
           formNuevaApuesta.reset();
           
           // Switch to active bets tab and update
           tabActivas.click();
           renderApuestasActivas();
           
           // Notificaci√≥n ficticia (en una app real usar√≠as la API de notificaciones)
           alert('¬°Nueva apuesta creada! üéâ');
	   });
 
       // Marcar como pagada
       function marcarPagada(id) {
           const apuesta = apuestas.find(a => a.id === id);
           if (!apuesta) return;
           
           if (confirm(`¬øConfirmas que la apuesta "${apuesta.titulo}" ha sido pagada?`)) {
               apuestas = apuestas.filter(a => a.id !== id);
               guardarDatos(); // Guardar en localStorage
               renderApuestasActivas();
           }
       }
 
	   // Finalizar apuesta
	   function finalizarApuesta(id) {
		   const apuesta = apuestas.find(a => a.id === id);
		   if (!apuesta) return;
		   
		   const ganador = prompt(`Introduce el ganador de "${apuesta.titulo}":`, apuesta.participantes[0]);
		   if (!ganador || !apuesta.participantes.includes(ganador)) {
			   alert('Por favor, introduce un participante v√°lido');
			   return;
		   }
		   
		   const resultado = prompt(`Introduce el resultado de "${apuesta.titulo}":`, "Detalles del resultado");
		   const tortillas = parseInt(prompt('¬øCu√°ntas tortillas se deben?', '1')) || 1;
		   
           // Mover a historial
           apuesta.estado = 'finalizada'; // Cambiar de 'activa' a 'finalizada' pero mantenerla en apuestas
           apuesta.ganador = ganador;
           apuesta.tortillas = tortillas;
           apuesta.resultado = resultado || "";
           
           // Mantener en apuestas hasta que se marque como pagada
           historial.unshift({...apuesta});
           guardarDatos(); // Guardar en localStorage
           
           renderApuestasActivas();
		   
		   // Notificaci√≥n mejorada
		   const mensaje = `${ganador} gan√≥ '${apuesta.titulo}'!\n\nüèÜ Premio: ${tortillas} tortilla(s)!\nüìÖ Fecha tope: ${new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toLocaleDateString()}\nüìç Lugar: Quedada en casa del perdedor`;
		   
		   // Notificar a todos los participantes
		   apuesta.participantes.forEach(participante => {
			   const esGanador = participante === ganador;
			   const mensajeIndividual = esGanador 
				   ? `üéâ ${mensaje}\n\n¬°Disfruta tu premio!` 
				   : `üòÖ ${mensaje}\n\n¬°A pagar la apuesta!`;
				   
			   console.log(`Notificaci√≥n para ${participante}: ${mensajeIndividual}`);
			   // En app real: enviar notificaci√≥n push o email
		   });
		   
		   alert(mensaje);
		   
		   // Mostrar el historial actualizado
		   renderHistorial();
		   updateEstadisticas();
	   }
 
       // Initialize
       document.addEventListener('DOMContentLoaded', () => {
           cargarDatos(); // Cargar datos del localStorage
           renderApuestasActivas();
           renderHistorial();
           updateEstadisticas();
		   
		   // Simular notificaci√≥n push (en una app real usar√≠as la API de notificaciones)
		   setTimeout(() => {
			   if (historial.length > 0) {
				   console.log('[Notificaci√≥n] Recordatorio: Hay tortillas pendientes de pagar');
			   }
		   }, 3000);
		   
		   // Registrar Service Worker para PWA (comentado hasta implementar)
		   // if ('serviceWorker' in navigator) {
		   //     navigator.serviceWorker.register('/sw.js');
		   // }
	   });
   </script>
</body>
</html>
